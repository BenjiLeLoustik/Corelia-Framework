#!/usr/bin/env php
<?php

/* ===== CoreliaPHP - CLI ===== */

/**
 * CLI principal de CoreliaPHP.
 * Permet de gérer les modules et de générer du code via des commandes en ligne.
 */

require __DIR__ . '/vendor/autoload.php';

use Corelia\CLI\ModuleManager;

// Tableau associatif des commandes disponibles et leur description
$commands = [
    'module:list'                        => 'Liste les modules.',
    'module:enable <module>'             => 'Active un module.',
    'module:disable <module>'            => 'Désactive un module.',
    'make:module <name>'                 => 'Crée un nouveau module.',
    'make:controller <module> <name>'    => 'Crée un contrôleur.',
    'help'                               => 'Affiche cette aide.',
];

// Récupération des arguments de la ligne de commande
$argv = $_SERVER['argv'];
$argc = $_SERVER['argc'];

// Commande demandée (par défaut : help)
$command = $argv[1] ?? 'help';

// Affiche l'aide si aucune commande ou commande 'help'
if ($command === 'help' || $argc < 2) {
    echo "\nUsage : php corelia <commande> [options]\n\n";
    echo "Commandes disponibles pour :\n";
    foreach ($commands as $name => $desc) {
        printf("  %-40s %s\n", $name, $desc);
    }
    echo "\n";
    exit(0);
}

// Instancie le gestionnaire de modules
$manager = new ModuleManager(__DIR__ . '/modules');

// Exécute la commande demandée
switch ($command) {
    case 'module:list':
        $manager->list();
        break;
    case 'module:enable':
        $manager->enable($argv[2] ?? null);
        break;
    case 'module:disable':
        $manager->disable($argv[2] ?? null);
        break;
    case 'make:module':
        (new \Corelia\CLI\Generator(__DIR__))->makeModule($argv[2] ?? null);
        break;
    case 'make:controller':
        (new \Corelia\CLI\Generator(__DIR__))->makeController($argv[2] ?? null, $argv[3] ?? null);
        break;
    default:
        echo "\nCommande inconnue. Tapez 'php corelia help' pour la liste des commandes.\n\n";
        exit(1);
}
